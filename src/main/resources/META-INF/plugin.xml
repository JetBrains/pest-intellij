<idea-plugin>
    <id>com.pestphp.pest-intellij</id>
    <name>Pest</name>
    <vendor>JetBrains</vendor>
    <description>Plugin provides Pest PHP test framework support</description>
    <resource-bundle>pestBundle</resource-bundle>
    <category>Test Tools</category>

    <!-- please see https://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/plugin_compatibility.html
         on how to target different products -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.jetbrains.php</depends>
    <depends optional="true" config-file="pest-coverage.xml">com.intellij.modules.coverage</depends>

    <extensions defaultExtensionNs="com.intellij">
        <psi.declarationProvider implementation="com.pestphp.pest.features.customExpectations.symbols.PestCustomExpectationSymbolDeclarationProvider"/>
        <psi.symbolReferenceProvider hostElementClass="com.jetbrains.php.lang.psi.elements.impl.MethodReferenceImpl"
                                     hostLanguage="PHP"
                                     implementationClass="com.pestphp.pest.features.customExpectations.symbols.PestCustomExpectationReferenceProvider"
                                     targetClass="com.pestphp.pest.features.customExpectations.symbols.PestCustomExpectationSymbol"/>
        <searcher forClass="com.intellij.find.usages.api.UsageSearchParameters"
                  implementationClass="com.pestphp.pest.features.customExpectations.symbols.PestCustomExpectationUsageSearcher"/>
        <searcher forClass="com.intellij.refactoring.rename.api.RenameUsageSearchParameters"
                  implementationClass="com.pestphp.pest.features.customExpectations.symbols.PestCustomExpectationRenameUsageSearcher"/>

        <stacktrace.fold substring="at vendor/"/>
        <codeInsight.parameterInfo language="PHP" order="before phpParameterInfo"
                                   implementationClass="com.pestphp.pest.features.customExpectations.CustomExpectationParameterInfoHandler"/>
        <runLineMarkerContributor
                language="PHP"
                implementationClass="com.pestphp.pest.PestTestRunLineMarkerProvider"
        />
        <codeInsight.lineMarkerProvider
                language="PHP"
                implementationClass="com.pestphp.pest.features.snapshotTesting.SnapshotLineMarkerProvider"
        />


        <programRunner implementation="com.pestphp.pest.configuration.PestDebugRunner"/>
        <configurationType implementation="com.pestphp.pest.configuration.PestRunConfigurationType"/>
        <runConfigurationProducer implementation="com.pestphp.pest.configuration.PestRunConfigurationProducer"/>
        <fileIconProvider implementation="com.pestphp.pest.PestIconProvider" order="before PhpFileIconProvider"/>
        <postStartupActivity implementation="com.pestphp.pest.features.customExpectations.CustomExpectationRemoveGeneratedFileStartupActivity"/>
        <testFinder implementation="com.pestphp.pest.goto.PestTestFinder"/>
        <fileBasedIndex implementation="com.pestphp.pest.indexers.PestTestIndex"/>
        <fileBasedIndex implementation="com.pestphp.pest.features.customExpectations.CustomExpectationIndex"/>
        <localInspection
                language="PHP"
                groupPath="PHP"
                groupKey="INSPECTION_PHP_GROUP_PEST"
                shortName="DuplicateTestNameInspection"
                enabledByDefault="true"
                key="INSPECTION_DUPLICATE_TEST_NAME"
                level="ERROR"
                implementationClass="com.pestphp.pest.inspections.DuplicateTestNameInspection"
        />
        <localInspection
                language="PHP"
                groupPath="PHP"
                groupKey="INSPECTION_PHP_GROUP_PEST"
                shortName="DuplicateCustomExpectationInspection"
                enabledByDefault="true"
                key="INSPECTION_DUPLICATE_CUSTOM_EXPECTATION"
                level="ERROR"
                implementationClass="com.pestphp.pest.inspections.DuplicateCustomExpectationInspection"
        />
        <localInspection
                language="PHP"
                groupPath="PHP"
                groupKey="INSPECTION_PHP_GROUP_PEST"
                shortName="InvalidTestNameCaseInspection"
                enabledByDefault="true"
                key="INSPECTION_INVALID_TEST_NAME_CASE"
                level="WEAK WARNING"
                implementationClass="com.pestphp.pest.inspections.InvalidTestNameCaseInspection"
        />
        <localInspection
                language="PHP"
                groupPath="PHP"
                groupKey="INSPECTION_PHP_GROUP_PEST"
                shortName="MultipleExpectChainableInspection"
                enabledByDefault="true"
                key="INSPECTION_MULTIPLE_CHAINABLE_EXPECT_CALLS"
                level="WEAK WARNING"
                implementationClass="com.pestphp.pest.inspections.MultipleExpectChainableInspection"
        />

        <completion.contributor implementationClass="com.pestphp.pest.completion.PestCompletionContributor"
                                language="PHP"/>
        <gotoDeclarationHandler implementation="com.pestphp.pest.completion.ThisFieldsCompletionProvider"/>
        <gotoDeclarationHandler implementation="com.pestphp.pest.goto.PestDatasetUsagesGotoHandler"/>
        <lang.inspectionSuppressor
                language="PHP"
                implementationClass="com.pestphp.pest.inspections.SuppressExpressionResultUnusedInspection"/>
        <lang.inspectionSuppressor
                language="PHP"
                implementationClass="com.pestphp.pest.inspections.SuppressUndefinedPropertyInspection"
        />
        <notificationGroup displayType="BALLOON" id="Outdated Pest" isLogByDefault="true" bundle="pestBundle"
                           key="NOTIFICATION_GROUP_OUTDATED_PEST"/>
        <lang.structureViewExtension implementation="com.pestphp.pest.structureView.PestStructureViewExtension"/>
        <gotoSymbolContributor implementation="com.pestphp.pest.goto.PestTestGoToSymbolContributor"/>
        <liveTemplateContext
                implementation="com.pestphp.pest.templates.PestRootTemplateContextType"
                contextId="ROOT_PESTPHP"/>
        <defaultLiveTemplates file="/liveTemplates/PestPHP.xml"/>
        <codeInsight.template.postfixTemplateProvider
                language="PHP"
                implementationClass="com.pestphp.pest.templates.PestPostfixTemplateProvider"/>
        <lang.surroundDescriptor
                language="PHP"
                implementationClass="com.pestphp.pest.surrounders.StatementSurroundDescriptor"/>
        <fileBasedIndex implementation="com.pestphp.pest.features.datasets.DatasetIndex"/>
        <localInspection
                language="PHP"
                groupPath="PHP"
                groupKey="INSPECTION_PHP_GROUP_PEST"
                shortName="InvalidDatasetReferenceInspection"
                enabledByDefault="true"
                key="INSPECTION_INVALID_DATASET_REFERENCE"
                level="ERROR"
                implementationClass="com.pestphp.pest.features.datasets.InvalidDatasetReferenceInspection"
        />
        <psi.referenceContributor
                implementation="com.pestphp.pest.features.datasets.DatasetReferenceContributor"
                language="PHP"/>
        <psi.referenceContributor
                implementation="com.pestphp.pest.features.uses.UsesReferenceContributor"
                language="PHP"/>
        <registryKey defaultValue="true"
                     description="Whether custom expectation file generation should happen."
                     key="pestphp.custom-expectations"
        />
        <internalFileTemplate name="Pest It"/>
        <internalFileTemplate name="Pest Test"/>
        <internalFileTemplate name="Pest Scoped Dataset"/>
        <internalFileTemplate name="Pest Shared Dataset"/>
        <localInspection
          language="PHP"
          groupPath="PHP"
          groupName="Pest"
          shortName="PestAssertionCanBeSimplifiedInspection"
          enabledByDefault="true"
          displayName="Assertion can be simplified"
          implementationClass="com.pestphp.pest.inspections.PestAssertionCanBeSimplifiedInspection"
        />
    </extensions>

    <extensions defaultExtensionNs="com.jetbrains.php">
        <testFrameworkType implementation="com.pestphp.pest.PestFrameworkType"/>
        <composerConfigClient implementation="com.pestphp.pest.PestComposerConfig"/>

        <typeProvider4 implementation="com.pestphp.pest.types.ThisTypeProvider"/>
        <typeProvider4 implementation="com.pestphp.pest.types.ThisFieldTypeProvider"/>
        <typeProvider4 implementation="com.pestphp.pest.types.ThisExtendTypeProvider"/>
        <typeProvider4 implementation="com.pestphp.pest.types.HigherOrderExtendTypeProvider"/>
        <libraryRoot id="pestphp" path="/library/Pest" runtime="false"/>
    </extensions>

    <actions>
        <action id="Pest.New.File"
                class="com.pestphp.pest.templates.PestConfigNewFileAction"
                icon="/file.svg">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFromTemplate"/>
        </action>
        <action id="Pest.New.Dataset"
                class="com.pestphp.pest.templates.PestConfigNewDatasetFileAction"
                icon="/dataset.svg">
            <add-to-group group-id="NewGroup" anchor="after" relative-to-action="Pest.New.File"/>
        </action>
    </actions>
</idea-plugin>